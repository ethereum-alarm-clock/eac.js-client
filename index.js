parcelRequire=function(e,r,n,t){function i(n,t){function o(e){return i(o.resolve(e))}function c(r){return e[n][1][r]||r}if(!r[n]){if(!e[n]){var l="function"==typeof parcelRequire&&parcelRequire;if(!t&&l)return l(n,!0);if(u)return u(n,!0);if(f&&"string"==typeof n)return f(n);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}o.resolve=c;var a=r[n]=new i.Module(n);e[n][0].call(a.exports,o,a,a.exports,this)}return r[n].exports}function o(e){this.id=e,this.bundle=i,this.exports={}}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;i.isParcelRequire=!0,i.Module=o,i.modules=e,i.cache=r,i.parent=u;for(var c=0;c<n.length;c++)i(n[c]);if(n.length){var l=i(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):t&&(this[t]=l)}return i}({41:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("memory-cache"),t=h(e),r=require("lodash"),s=h(r);function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}class i{constructor(e){this.cache=new t.Cache,this.logger=e,this.mem=[]}set(e,t){-1===s.indexOf(this.mem,e)&&this.mem.push(e),this.cache.put(e,t),this.logger.cache(`stored ${e} with value ${t}`)}get(e,t){if(null===this.cache.get(e)){if(void 0===t)throw new Error("attempted to access key entry that does not exist");return t}return this.logger.cache(`accessed ${e}`),this.cache.get(e)}has(e){return null===this.cache.get(e)?(this.logger.cache(`miss ${e}`),!1):(this.logger.cache(`hit ${e}`),!0)}del(e){s.remove(this.mem,t=>t===e),this.cache.del(e),this.logger.cache(`deleted ${e}`)}len(){return this.cache.size()}stored(){return this.mem}isEmpty(){return 0===this.len()}sweepExpired(){this.mem.forEach(e=>{99===this.get(e,0)&&this.del(e)})}}exports.default=i;
},{}],36:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Cache");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return t(e).default}});
},{"./Cache":41}],22:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("ethereumjs-wallet"),t=s(e);function s(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}var n=function(e,t,s,n){return new(s||(s=Promise))(function(r,i){function o(e){try{d(n.next(e))}catch(e){i(e)}}function a(e){try{d(n.throw(e))}catch(e){i(e)}}function d(e){e.done?r(e.value):new s(function(t){t(e.value)}).then(o,a)}d((n=n.apply(e,t||[])).next())})};class r{constructor(e,t){this.length=0,this.logger=t,this.nonce=0,this.web3=e,this.walletStates={}}getBalanceOf(e){return new Promise(t=>{t(this.web3.eth.getBalance(e))})}_findSafeIndex(e=0){return e=e,this.hasOwnProperty(e)?this._findSafeIndex(e+1):e}_currentIndexes(){return Object.keys(this).map(e=>parseInt(e,10)).filter(e=>e<9e20).slice(0,this.length)}create(e){for(let s=0;s<e;s++){const e=t.generate();this.add(e)}return this}add(e){if(!this[e.getAddressString()]){const t=this._findSafeIndex();return e.index=t,this[t]=e,this[e.getAddressString()]=e,this[e.getAddressString().toLowerCase()]=e,this.length++,e}return this[e.getAddressString()]}rm(e){const t=this[e];return!(!t||!t.getAddressString())&&(delete this[t.getAddressString()],delete this[t.getAddressString().toLowerCase()],delete this[t.index],this.length--,!0)}clear(){return this._currentIndexes().forEach(e=>{this.rm(e)}),this}encrypt(e,t){return this._currentIndexes().map(s=>this[s].toV3(e,t))}loadPrivateKeys(e){e.forEach(e=>{const s=t.fromPrivateKey(Buffer.from(e,"hex"));if(!s)throw new Error("Couldn't load private key.");this.add(s)})}decrypt(e,s){e.forEach(e=>{const n=t.fromV3(e,s,!0);if(!n)throw new Error("Couldn't decrypt keystore. Wrong password?");this.add(n)})}sendFromNext(e){const t=this.nonce++%this.length;return this.sendFromIndex(t,e)}getNonce(e){return new Promise((t,s)=>{this.web3.eth.getTransactionCount(e,(e,n)=>{e&&s(e),t(n)})})}sendRawTransaction(e){return new Promise((t,s)=>{this.web3.eth.sendRawTransaction("0x".concat(e.serialize().toString("hex")),(e,n)=>{e&&s(e),t(n)})})}getTransactionReceipt(e,t){return n(this,void 0,void 0,function*(){let s;const r=this;return s=function(e,i,o){return n(this,void 0,void 0,function*(){try{var n=yield(e=>new Promise(t=>{r.web3.eth.getTransactionReceipt(e,(e,s)=>{e||t(s)})}))(e);null==n?setTimeout(function(){s(e,i,o)},500):i({receipt:n,from:t})}catch(e){o(e)}})},new Promise((t,r)=>n(this,void 0,void 0,function*(){yield s(e,t,r)}))})}signTransaction(e,t,s){return new Promise(n=>{const r={nonce:t,from:e,to:s.to,gas:this.web3.toHex(s.gas),gasPrice:this.web3.toHex(s.gasPrice),value:this.web3.toHex(s.value),data:s.data},i=new(require("ethereumjs-tx"))(r),o=this[e].privKey;i.sign(Buffer.from(o,"hex")),n(i)})}isWalletAbleToSendTx(e){if(e>=this.length)throw new Error("Index is outside range of addresses.");const t=this.getAccounts()[e].getAddressString();return!this.walletStates[t]||!this.walletStates[t].sendingTxInProgress}isNextAccountFree(){return this.isWalletAbleToSendTx(this.nonce%this.length)}sendFromIndex(e,t){return n(this,void 0,void 0,function*(){if(e>=this.length)throw new Error("Index is outside range of addresses.");const s=this.getAccounts()[e].getAddressString();if((yield this.getBalanceOf(s)).eq(0))return this.logger&&this.logger.info(`Account ${s} has not enough funds to send transaction.`),{ignore:!0};const n=yield this.getNonce(s),r=yield this.signTransaction(s,n,t);if(this.walletStates[s]&&this.walletStates[s].sendingTxInProgress)return this.logger&&this.logger.debug(`Sending transaction is already in progress. Please wait for account: "${s}" to complete tx.`),{ignore:!0};let i,o=!1;try{this.walletStates[s]||(this.walletStates[s]={}),this.walletStates[s].sendingTxInProgress=!0;const e=yield this.sendRawTransaction(r);i=yield this.getTransactionReceipt(e,s)}catch(e){this.logger&&this.logger.debug("Sending transaction failed."),o=!0}finally{this.walletStates[s].sendingTxInProgress=!1}return Object.assign(i,{ignore:o})})}getAccounts(){return this._currentIndexes().map(e=>this[e])}getAddresses(){return this.getAccounts().map(e=>e.getAddressString())}isKnownAddress(e){return this.getAddresses().some(t=>t===e)}}exports.default=r;
},{}],6:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Wallet");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return t(e).default}});
},{"./Wallet":22}],42:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{cache(t){this.formatPrint(t,"CACHE")}debug(t){this.formatPrint(t,"DEBUG")}error(t){this.formatPrint(t,"ERROR")}info(t){this.formatPrint(t,"INFO")}formatPrint(t,r){console.log(r,this.timestamp(),t)}timestamp(){return Math.floor(Date.now()/1e3)}}exports.DefaultLogger=t;
},{}],37:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./DefaultLogger");Object.defineProperty(exports,"DefaultLogger",{enumerable:!0,get:function(){return e.DefaultLogger}});
},{"./DefaultLogger":42}],35:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(e){this.web3=e}estimateGas(e){return new Promise((t,r)=>{this.web3.eth.estimateGas(e,(e,s)=>{e?r(e):t(s)})})}networkGasPrice(){return new Promise((e,t)=>{this.web3.eth.getGasPrice((r,s)=>{r?t(r):e(s)})})}getReceipt(e){return new Promise((t,r)=>{this.web3.eth.getTransactionReceipt(e,(e,s)=>{e?r(e):t(s)})})}getBlockNumber(){return new Promise((e,t)=>{this.web3.eth.getBlockNumber((r,s)=>{r?t(r):e(s)})})}getBlock(e="latest"){return new Promise((t,r)=>{this.web3.eth.getBlock(e,(s,i)=>{s?r(s):i?t(i):r(`Returned block ${e} is null`)})})}isWatchingEnabled(){return new Promise(e=>{this.web3.currentProvider.sendAsync({jsonrpc:"2.0",id:1,method:"eth_getFilterLogs",params:[]},t=>{null!==t&&e(!1),e(!0)})})}}exports.default=e;
},{}],21:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("../Cache"),t=o(e),s=require("../Wallet"),r=o(s),a=require("../Logger"),l=require("../Util"),i=o(l);function o(e){return e&&e.__esModule?e:{default:e}}class h{constructor(e){if(this.autostart=e.autostart||!0,this.ms=e.ms||4e3,this.scanSpread=e.scanSpread||50,this.walletStoresAsPrivateKeys=e.walletStoresAsPrivateKeys,this.logger=e.logger||new a.DefaultLogger,this.cache=new t.default(this.logger),!(e.eac&&e.factory&&e.provider&&e.web3))throw new Error("Passed in Config params are incomplete! Unable to start TimeNode. Quitting..");this.eac=e.eac,this.factory=e.factory,this.provider=e.provider,this.web3=e.web3,e.walletStores&&e.walletStores.length&&e.walletStores.length>0?(this.wallet=new r.default(this.web3,this.logger),e.walletStores=e.walletStores.map(e=>"object"==typeof e?JSON.stringify(e):e),this.walletStoresAsPrivateKeys?this.wallet.loadPrivateKeys(e.walletStores):this.wallet.decrypt(e.walletStores,e.password)):this.wallet=null,this.statsDb=e.statsDb,this.util=new i.default(this.web3),this.economicStrategy=e.economicStrategy}}exports.default=h;
},{"../Cache":36,"../Wallet":6,"../Logger":37,"../Util":35}],5:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Config");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return t(e).default}});
},{"./Config":21}],38:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=e=>{if(e){const s="0x3e504bb8b225ad41f613b0c3c4205cdd752d1615b4d77cd1773417282fcfb5d9";return e.logs[0].topics.indexOf(s)>-1}return!1},s=e=>e&&-1!==[1,"0x1","0x01"].indexOf(e);exports.isExecuted=e,exports.isTransactionStatusSuccessful=s;
},{}],29:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=exports.Networks=void 0;!function(e){e[e.Private=0]="Private",e[e.Mainnet=1]="Mainnet",e[e.Morden=2]="Morden",e[e.Ropsten=3]="Ropsten",e[e.Rinkeby=4]="Rinkeby",e[e.Kovan=42]="Kovan"}(e||(exports.Networks=e={}));
},{}],30:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=exports.TxStatus=void 0;!function(e){e[e.BeforeClaimWindow=0]="BeforeClaimWindow",e[e.ClaimWindow=1]="ClaimWindow",e[e.FreezePeriod=2]="FreezePeriod",e[e.ExecutionWindow=3]="ExecutionWindow",e[e.Executed=4]="Executed",e[e.Missed=5]="Missed",e[e.Done=6]="Done"}(e||(exports.TxStatus=e={}));
},{}],31:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=exports.FnSignatures=void 0;!function(e){e.claim="0x4e71d92d",e.execute="0x61461954"}(e||(exports.FnSignatures=e={}));
},{}],13:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Networks");Object.defineProperty(exports,"Networks",{enumerable:!0,get:function(){return e.Networks}});var r=require("./TxStatus");Object.defineProperty(exports,"TxStatus",{enumerable:!0,get:function(){return r.TxStatus}});var t=require("./FnSignatures");Object.defineProperty(exports,"FnSignatures",{enumerable:!0,get:function(){return t.FnSignatures}});
},{"./Networks":29,"./TxStatus":30,"./FnSignatures":31}],39:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=void 0,n=require("../Enum"),t=function(e,n,t,r){return new(t||(t=Promise))(function(i,c){function s(e){try{u(r.next(e))}catch(e){c(e)}}function o(e){try{u(r.throw(e))}catch(e){c(e)}}function u(e){e.done?i(e.value):new t(function(n){n(e.value)}).then(s,o)}u((r=r.apply(e,n||[])).next())})};const r=(n,r,i)=>t(e,void 0,void 0,function*(){i.checkGasPrice=void 0===i.checkGasPrice||i.checkGasPrice;const e=n.web3.currentProvider;return new Promise((o,u)=>{e.sendAsync({jsonrpc:"2.0",method:"parity_pendingTransactions",params:[],id:7},(e,d)=>t(this,void 0,void 0,function*(){e&&u(e);for(const e in d.result)if(d.result[e].to===r.address){const t=d.result[e]&&(!i.checkGasPrice||(yield c(n.web3,d.result[e],i.exactPrice)));d.result[e]&&s(d.result[e],i.type)&&t&&o(!0)}o(!1)}))})}),i=(n,r,i)=>{i.checkGasPrice=void 0===i.checkGasPrice||i.checkGasPrice;const o=n.web3.currentProvider;return new Promise((u,d)=>{o.send({jsonrpc:"2.0",method:"txpool_content",params:[],id:7},(o,a)=>t(e,void 0,void 0,function*(){o&&d(o);for(const e in a.result.pending)for(const t in a.result.pending[e])if(a.result.pending[e][t].to===r.address){const r=a.result.pending[e][t]&&(!i.checkGasPrice||(yield c(n.web3,a.result.pending[e][t],i.exactPrice)));a.result.pending[e][t]&&s(a.result.pending[e][t],i.type)&&r&&u(!0)}u(!1)}))})},c=(n,r,i)=>t(e,void 0,void 0,function*(){if(i)return i.valueOf()==r.gasPrice.valueOf();let e;return yield new Promise((t,r)=>{n.eth.getGasPrice((n,i)=>{n&&r(n),e=i,t(!0)})}),e&&.3*e.valueOf()<=r.gasPrice.valueOf()}),s=(e,t)=>!(!e||t)||e.input==n.FnSignatures[t],o=(e,n,t)=>"parity"==e.client?r(e,n,t):"geth"==e.client?i(e,n,t):void 0;exports.default=o;
},{"../Enum":13}],32:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shortenAddress=c;var e=require("bignumber.js"),t=n(e),i=require("./Helpers"),s=require("./Pending"),a=n(s);function n(e){return e&&e.__esModule?e:{default:e}}var r=function(e,t,i,s){return new(i||(i=Promise))(function(a,n){function r(e){try{o(s.next(e))}catch(e){n(e)}}function c(e){try{o(s.throw(e))}catch(e){n(e)}}function o(e){e.done?a(e.value):new i(function(t){t(e.value)}).then(r,c)}o((s=s.apply(e,t||[])).next())})};function c(e){return`${e.slice(0,6)}...${e.slice(e.length-5,e.length)}`}class o{constructor(e){this.config=e}claim(e){return r(this,void 0,void 0,function*(){const s=e.requiredDeposit,n=e.claimData,r={to:e.address,value:s,gas:12e4,gasPrice:yield this.config.util.networkGasPrice(),data:n};if(yield(0,a.default)(this.config,e,{type:"claim"}))return{ignore:!0};if(this.config.wallet.isNextAccountFree())try{var o=yield this.config.wallet.sendFromNext(r);const s=o.receipt,a=o.from;if(o.ignore)return;if((0,i.isTransactionStatusSuccessful)(s.status)){yield e.refreshData();const i=new t.default(s.gasUsed).mul(new t.default(e.data.txData.gasPrice));return this.config.statsDb.updateClaimed(a,i),e.isClaimed}return!1}catch(t){this.config.logger.debug(`Actions::claim(${c(e.address)})::sendFromIndex error: ${t}`)}else this.config.logger.debug(`Actions::claim(${c(e.address)})::Wallet with index 0 is not able to send tx.`)})}execute(e){return r(this,void 0,void 0,function*(){const s=e.callGas.add(18e4).div(64).times(65).round(),n=e.executeData,r=this.config.wallet.getAddresses().indexOf(e.claimedBy);this.config.logger.debug(`Claim Index ${r}`);const c={to:e.address,value:0,gas:s,gasPrice:e.gasPrice,data:n};if(yield(0,a.default)(this.config,e,{type:"execute",exactPrice:c.gasPrice}))return{ignore:!0};if(-1!==r){var o=yield this.config.wallet.sendFromIndex(r,c);const s=o.receipt,a=o.from;if(o.ignore)return;if((0,i.isTransactionStatusSuccessful)(s.status)){if((0,i.isExecuted)(s)){yield e.refreshData();const i=s.logs[0].data,n=this.config.web3.toDecimal(i.slice(0,66));this.config.statsDb.updateExecuted(a,n,new t.default(0))}const n=new t.default(s.gasUsed).mul(new t.default(e.data.txData.gasPrice));return this.config.statsDb.updateExecuted(a,new t.default(0),n),e.wasSuccessful}return!1}if(this.config.wallet.isNextAccountFree()){var u=yield this.config.wallet.sendFromNext(c);const s=u.receipt,a=u.from;if(u.ignore)return;if((0,i.isTransactionStatusSuccessful)(s.status)){if((0,i.isExecuted)(s)){yield e.refreshData();const i=s.logs[0].data,n=this.config.web3.toDecimal(i.slice(0,66));this.config.statsDb.updateExecuted(a,n,new t.default(0))}const n=new t.default(s.gasUsed).mul(new t.default(e.data.txData.gasPrice));return this.config.statsDb.updateExecuted(a,new t.default(0),n),e.wasSuccessful}return!1}this.config.logger.debug("Actions.execute : No available wallet to send a transaction.")})}cleanup(e){return r(this,void 0,void 0,function*(){throw Error("Not implemented according to latest EAC changes.")})}}exports.default=o;
},{"./Helpers":38,"./Pending":39}],14:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Actions");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return t(e).default}});
},{"./Actions":32}],44:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=exports.BucketSize={block:240,timestamp:3600};
},{}],40:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./consts");Object.defineProperty(exports,"BucketSize",{enumerable:!0,get:function(){return e.BucketSize}});
},{"./consts":44}],33:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("../Buckets"),e=function(t,e,i,c){return new(i||(i=Promise))(function(s,n){function r(t){try{o(c.next(t))}catch(t){n(t)}}function u(t){try{o(c.throw(t))}catch(t){n(t)}}function o(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(r,u)}o((c=c.apply(t,e||[])).next())})};exports.default=class{constructor(t,e){this.buckets={currentBuckets:{blockBucket:-1,timestampBucket:-1},nextBuckets:{blockBucket:-1,timestampBucket:-1}},this.eventWatchers={},this.config=t,this.util=t.util,this.scanning=!1,this.router=e,this.requestFactory=t.eac.requestFactory()}runAndSetInterval(t,i){return e(this,void 0,void 0,function*(){const c=()=>e(this,void 0,void 0,function*(){try{yield t()}catch(t){this.config.logger.error(t)}});return yield c(),setInterval(c,i)})}start(){return e(this,void 0,void 0,function*(){return(yield this.util.isWatchingEnabled())?(this.config.logger.info("Watching ENABLED"),this.chainScanner=yield this.runAndSetInterval(()=>this.watchBlockchain(),3e5)):(this.config.logger.info("Watching DISABLED"),this.config.logger.info("-Initiating Backup Scanner-"),this.chainScanner=yield this.runAndSetInterval(()=>this.backupScanBlockchain(),this.config.ms)),this.cacheScanner=yield this.runAndSetInterval(()=>this.scanCache(),this.config.ms),this.scanning=!0,this.scanning})}stop(){return this.scanning&&(clearInterval(this.cacheScanner),clearInterval(this.chainScanner),this.config.logger.info("Scanner STOPPED"),this.scanning=!1),this.scanning}isUpcoming(t){return e(this,void 0,void 0,function*(){return(yield t.beforeClaimWindow())||(yield t.inClaimWindow())||(yield t.inFreezePeriod())||(yield t.inExecutionWindow())})}getCurrentBuckets(t){return e(this,void 0,void 0,function*(){const e=yield this.requestFactory;return{blockBucket:e.calcBucket(t.number,1),timestampBucket:e.calcBucket(t.timestamp,2)}})}getNextBuckets(i){return e(this,void 0,void 0,function*(){const e=yield this.requestFactory,c=i.number+t.BucketSize.block,s=i.timestamp+t.BucketSize.timestamp;return{blockBucket:e.calcBucket(c,1),timestampBucket:e.calcBucket(s,2)}})}getBuckets(){return e(this,void 0,void 0,function*(){const t=yield this.util.getBlock("latest");return{currentBuckets:yield this.getCurrentBuckets(t),nextBuckets:yield this.getNextBuckets(t)}})}handleRequest(t){if(!this.isValid(t.address))throw new Error(`[${t.address}] NOT VALID`);this.config.logger.info(`[${t.address}] Discovered`),this.config.cache.has(t.address)||this.store(t)}backupScanBlockchain(){return e(this,void 0,void 0,function*(){const t=yield this.requestFactory;var e=yield this.getBuckets();const i=e.currentBuckets,c=e.nextBuckets,s=this.handleRequest.bind(this);(yield t.getRequestsByBucket(i.blockBucket)).map(s),(yield t.getRequestsByBucket(i.timestampBucket)).map(s),(yield t.getRequestsByBucket(c.blockBucket)).map(s),(yield t.getRequestsByBucket(c.timestampBucket)).map(s)})}stopWatcher(t){return e(this,void 0,void 0,function*(){const e=this.eventWatchers[t];if(void 0!==e){yield(yield this.requestFactory).stopWatch(e),delete this.eventWatchers[t]}})}watchRequestsByBucket(t,i){return e(this,void 0,void 0,function*(){const e=yield this.requestFactory,c=this.handleRequest.bind(this);if(t!==i){this.stopWatcher(i);const s=yield e.watchRequestsByBucket(t,c);this.eventWatchers[t]=s}})}watchBlockchain(){return e(this,void 0,void 0,function*(){const t=yield this.getBuckets();yield this.watchRequestsByBucket(t.currentBuckets.blockBucket,this.buckets.currentBuckets.blockBucket),yield this.watchRequestsByBucket(t.nextBuckets.blockBucket,this.buckets.nextBuckets.blockBucket),yield this.watchRequestsByBucket(t.currentBuckets.timestampBucket,this.buckets.currentBuckets.timestampBucket),yield this.watchRequestsByBucket(t.nextBuckets.timestampBucket,this.buckets.nextBuckets.timestampBucket),this.buckets=t})}isValid(t){if(t===this.config.eac.Constants.NULL_ADDRESS)return this.config.logger.debug("Warning.. Transaction Request with NULL_ADDRESS found."),!1;if(!this.config.eac.Util.checkValidAddress(t))throw new Error(`[${t}] Received invalid response from Request Tracker - CRITICAL BUG`);return!0}scanCache(){return e(this,void 0,void 0,function*(){if(this.config.cache.isEmpty())return;const t=this.config.cache.stored().filter(t=>this.config.cache.get(t)>0).map(t=>this.config.eac.transactionRequest(t));(yield Promise.all(t)).forEach(t=>{t.refreshData().then(()=>this.router.route(t))})})}store(t){this.config.logger.info(`[${t.address}] Inputting to cache`),this.config.cache.set(t.address,t.params[7])}};
},{"../Buckets":40}],15:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Scanner");function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return r(e).default}});
},{"./Scanner":33}],45:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.shouldClaimTx=void 0;var t=void 0,e=require("bluebird"),n=o(e);function o(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}var i=function(t,e,n,o){return new(n||(n=Promise))(function(i,r){function c(t){try{a(o.next(t))}catch(t){r(t)}}function u(t){try{a(o.throw(t))}catch(t){r(t)}}function a(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(c,u)}a((o=o.apply(t,e||[])).next())})};const r=(t,e)=>{const n=t.requiredDeposit,o=e.maxDeposit;return n.gt(o)},c=(e,o)=>i(t,void 0,void 0,function*(){const t=e.minBalance;return(yield n.fromCallback(t=>o.web3.eth.getBalance(o.wallet.getAddresses()[0],t))).gt(t)}),u=(e,n)=>i(t,void 0,void 0,function*(){const t=yield e.claimPaymentModifier(),o=e.bounty.times(t),i=n.minProfitability;return!i.gt(0)||o.lt(i)}),a=(e,n)=>i(t,void 0,void 0,function*(){const t=yield u(e,n.economicStrategy);if(!t)return!1;const o=yield c(n.economicStrategy,n);if(!o)return!1;const i=r(e,n.economicStrategy);return t&&o&&!i});exports.shouldClaimTx=a;
},{}],43:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./EconomicStrategyHelpers");Object.defineProperty(exports,"shouldClaimTx",{enumerable:!0,get:function(){return e.shouldClaimTx}});
},{"./EconomicStrategyHelpers":45}],34:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TEMPORAL_UNIT=void 0;var i=require("../Enum"),t=require("../EconomicStrategy"),e=function(i,t,e,n){return new(e||(e=Promise))(function(s,o){function r(i){try{a(n.next(i))}catch(i){o(i)}}function d(i){try{a(n.throw(i))}catch(i){o(i)}}function a(i){i.done?s(i.value):new e(function(t){t(i.value)}).then(r,d)}a((n=n.apply(i,t||[])).next())})};class n{}exports.TEMPORAL_UNIT=n,n.BLOCK=1,n.TIMESTAMP=2;class s{constructor(t,e){this.txRequestStates={},this.transitions={},this.actions=e,this.config=t,this.util=t.util,this.transitions[i.TxStatus.BeforeClaimWindow]=this.beforeClaimWindow.bind(this),this.transitions[i.TxStatus.ClaimWindow]=this.claimWindow.bind(this),this.transitions[i.TxStatus.FreezePeriod]=this.freezePeriod.bind(this),this.transitions[i.TxStatus.ExecutionWindow]=this.executionWindow.bind(this),this.transitions[i.TxStatus.Executed]=this.executed.bind(this),this.transitions[i.TxStatus.Missed]=this.missed.bind(this),this.transitions[i.TxStatus.Done]=(t=>(this.config.logger.info(`[${t.address}] Finished. Deleting from cache...`),this.config.cache.del(t.address),i.TxStatus.Done))}beforeClaimWindow(t){return e(this,void 0,void 0,function*(){return t.isCancelled?i.TxStatus.Executed:(yield t.beforeClaimWindow())?i.TxStatus.BeforeClaimWindow:i.TxStatus.ClaimWindow})}claimWindow(n){return e(this,void 0,void 0,function*(){if(!(yield n.inClaimWindow()))return i.TxStatus.FreezePeriod;if(n.isClaimed)return i.TxStatus.FreezePeriod;if(yield(0,t.shouldClaimTx)(n,this.config))try{!0===(yield this.actions.claim(n))&&this.config.logger.info(`${n.address} claimed`)}catch(i){throw this.config.logger.error(`${n.address} claiming failed`),new Error(i)}else this.config.logger.info(`[${n.address}] not profitable to claim.`),this.config.logger.debug(`ECONOMIC STRATEGY: ${JSON.stringify(this.config.economicStrategy)}`);return i.TxStatus.ClaimWindow})}freezePeriod(t){return e(this,void 0,void 0,function*(){return(yield t.inFreezePeriod())?i.TxStatus.FreezePeriod:(yield t.inExecutionWindow())?i.TxStatus.ExecutionWindow:i.TxStatus.FreezePeriod})}inReservedWindowAndNotClaimedLocally(i){return e(this,void 0,void 0,function*(){return(yield i.inReservedWindow())&&i.isClaimed&&!this.isLocalClaim(i)})}executionWindow(t){return e(this,void 0,void 0,function*(){if(t.wasCalled)return i.TxStatus.Executed;if(yield this.isTransactionMissed(t))return i.TxStatus.Missed;if(yield this.inReservedWindowAndNotClaimedLocally(t))return i.TxStatus.ExecutionWindow;try{if(!0===(yield this.actions.execute(t)))return this.config.logger.info(`${t.address} executed`),i.TxStatus.Executed}catch(i){throw this.config.logger.error(`${t.address} execution failed`),new Error(i)}return i.TxStatus.ExecutionWindow})}isExecuted(i){if(i){const t="0x3e504bb8b225ad41f613b0c3c4205cdd752d1615b4d77cd1773417282fcfb5d9";return i.logs[0].topics.indexOf(t)>-1}return!1}executed(t){return e(this,void 0,void 0,function*(){return i.TxStatus.Done})}missed(t){return e(this,void 0,void 0,function*(){return i.TxStatus.Done})}isTransactionMissed(i){return e(this,void 0,void 0,function*(){const t=parseInt(i.executionWindowEnd)<=parseInt(yield i.now());return Boolean(t&&!i.wasCalled)})}isLocalClaim(i){let t;return(t=this.config.wallet?this.config.wallet.isKnownAddress(i.claimedBy):i.isClaimedBy(this.config.web3.eth.accounts[0]))||this.config.logger.debug(`[${i.address}] In reserve window and not claimed by this TimeNode.`),t}route(t){return e(this,void 0,void 0,function*(){let e=this.txRequestStates[t.address]||i.TxStatus.BeforeClaimWindow;let n=yield(0,this.transitions[e])(t);for(;n!==e;)this.config.logger.info(`${t.address} Transitioning from  ${i.TxStatus[e]} to ${i.TxStatus[n]} (${n})`),e=n,n=yield this.transitions[e](t);return this.txRequestStates[t.address]=n,n})}}exports.default=s;
},{"../Enum":13,"../EconomicStrategy":43}],16:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./Router");function t(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"default",{enumerable:!0,get:function(){return t(e).default}});
},{"./Router":34}],27:[function(require,module,exports) {
module.exports={name:"eac.js-client",version:"3.0.2",description:"JavaScript library containing key logic for the Ethereum Alarm Clock TimeNode",main:"index.js",scripts:{build:"tsc && npm run parcel && npm run clean-built",parcel:"./node_modules/.bin/parcel build built/index.js -d . --target=node","clean-backups":"find . -type f -name '*.b' -delete","clean-built":"rm -rf built",clean:"npm run clean-backups && npm run clean-built",fmt:"node scripts/fmt.js",test:"mocha --timeout 50000 -r ts-node/register test/*.ts test/unit/*.ts --exit","test-noexit":"mocha -r ts-node/register test/*.ts",lint:"eslint .","deploy-eac":"sh scripts/deploy_eac.sh",ganache:'ganache-cli -m "shove afford modify census bridge good random error fault floor fringe oblige" -i 1002'},repository:{type:"git",url:"git+https://github.com/ethereum-alarm-clock/eac.js-client.git"},keywords:["ethereum","smart-contracts","ethereum-alarm-clock"],author:"lsaether",license:"MIT",bugs:{url:"https://github.com/ethereum-alarm-clock/eac.js-client/issues"},homepage:"https://github.com/ethereum-alarm-clock/eac.js-client#readme",dependencies:{"@types/es6-promise":"3.3.0","babel-polyfill":"6.26.0","bignumber.js":"5.0.0","eac.js-lib":"2.0.2","ethereumjs-tx":"1.3.4","ethereumjs-wallet":"0.6.0",lodash:"4.17.10",lokijs:"1.5.5","memory-cache":"0.2.0"},devDependencies:{"@types/bluebird":"3.5.20","@types/chai":"4.1.3","@types/ethereumjs-tx":"1.0.0","@types/lodash":"4.14.109","@types/lokijs":"1.5.2","@types/memory-cache":"0.2.0","@types/node":"10.3.2",bluebird:"3.5.1",chai:"4.1.2","ganache-core":"2.1.0",husky:"1.0.0-rc.8",mocha:"5.1.1","mocha-typescript":"1.1.16",moment:"2.22.2",parcel:"1.8.1",prettier:"1.13.4","ts-node":"6.1.0",typescript:"2.9.1",typings:"2.1.1",web3:"0.20.6"},husky:{hooks:{"pre-commit":"npm run fmt"}}};
},{}],11:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../package.json").version;exports.default=e;
},{"../package.json":27}],3:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./Actions"),e=a(t),n=require("./Enum"),i=require("./Scanner"),r=a(i),s=require("./Router"),o=a(s),c=require("./Version"),u=a(c);function a(t){return t&&t.__esModule?t:{default:t}}var f=function(t,e,n,i){return new(n||(n=Promise))(function(r,s){function o(t){try{u(i.next(t))}catch(t){s(t)}}function c(t){try{u(i.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(o,c)}u((i=i.apply(t,e||[])).next())})};class h{constructor(t){this.actions=new e.default(t),this.config=t,this.router=new o.default(this.config,this.actions),this.scanner=new r.default(this.config,this.router),this.config.statsDb.initialize(this.config.wallet.getAddresses()),this.startupMessage()}startupMessage(){this.config.logger.info("EAC-TimeNode"),this.config.logger.info("Version: "+u.default)}logNetwork(){this.config.web3.version.getNetwork((t,e)=>{if(t)throw new Error(t);this.config.logger.info("Operating on "+n.Networks[e])})}startScanning(){return f(this,void 0,void 0,function*(){return this.scanner.scanning&&this.scanner.stop(),this.scanner.start()})}stopScanning(){return this.scanner.stop()}}exports.default=h;
},{"./Actions":14,"./Enum":13,"./Scanner":15,"./Router":16,"./Version":11}],23:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StatsDB=void 0;var t=require("bignumber.js"),s=e(t);function e(t){return t&&t.__esModule?t:{default:t}}var n=function(t,s,e,n){return new(e||(e=Promise))(function(i,o){function c(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){t.done?i(t.value):new e(function(s){s(t.value)}).then(c,u)}a((n=n.apply(t,s||[])).next())})};class i{constructor(t,s){this.db=s,this.web3=t,this.eac=require("eac.js-lib")(t);const e=this.db.getCollection("stats");this.stats=null!==e?e:this.db.addCollection("stats")}initialize(t){t.forEach(t=>n(this,void 0,void 0,function*(){const e=this.stats.find({account:t})[0];if(e){const t=e.bounties||0,n=e.costs||0;e.bounties=new s.default(t),e.costs=new s.default(n)}else this.stats.insert({account:t,claimed:0,executed:0,bounties:new s.default(0),costs:new s.default(0),executedTransactions:[]})}))}updateClaimed(t,s){return n(this,void 0,void 0,function*(){const e=this.stats.find({account:t})[0];e.claimed+=1,e.costs=e.costs.plus(s),this.stats.update(e)})}updateExecuted(t,s,e){return n(this,void 0,void 0,function*(){const n=this.stats.find({account:t})[0];n&&(n.executed+=1,n.executedTransactions.push({timestamp:Date.now()}),n.bounties=n.bounties.plus(s),n.costs=n.costs.plus(e),this.stats.update(n))})}getStats(){return this.stats.data}}exports.StatsDB=i;
},{}],7:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./StatsDB");Object.defineProperty(exports,"StatsDB",{enumerable:!0,get:function(){return e.StatsDB}});
},{"./StatsDB":23}],1:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.StatsDB=exports.Wallet=exports.TimeNode=exports.Config=void 0,require("core-js/modules/es6.typed.array-buffer"),require("core-js/modules/es6.typed.int8-array"),require("core-js/modules/es6.typed.uint8-array"),require("core-js/modules/es6.typed.uint8-clamped-array"),require("core-js/modules/es6.typed.int16-array"),require("core-js/modules/es6.typed.uint16-array"),require("core-js/modules/es6.typed.int32-array"),require("core-js/modules/es6.typed.uint32-array"),require("core-js/modules/es6.typed.float32-array"),require("core-js/modules/es6.typed.float64-array"),require("core-js/modules/es6.map"),require("core-js/modules/es6.set"),require("core-js/modules/es6.weak-map"),require("core-js/modules/es6.weak-set"),require("core-js/modules/es6.promise"),require("core-js/modules/es6.symbol"),require("core-js/modules/es6.function.name"),require("core-js/modules/es6.array.from"),require("core-js/modules/es7.object.values"),require("core-js/modules/es7.object.entries"),require("core-js/modules/es7.object.get-own-property-descriptors"),require("core-js/modules/es7.string.pad-start"),require("core-js/modules/es7.string.pad-end");var e=require("./Config"),r=d(e),s=require("./TimeNode"),o=d(s),u=require("./Wallet"),t=d(u),i=require("./Stats");function d(e){return e&&e.__esModule?e:{default:e}}exports.Config=r.default,exports.TimeNode=o.default,exports.Wallet=t.default,exports.StatsDB=i.StatsDB;
},{"./Config":5,"./TimeNode":3,"./Wallet":6,"./Stats":7}]},{},[1], null)
//# sourceMappingURL=/index.map